(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))o(e);new MutationObserver(e=>{for(const i of e)if(i.type==="childList")for(const s of i.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&o(s)}).observe(document,{childList:!0,subtree:!0});function r(e){const i={};return e.integrity&&(i.integrity=e.integrity),e.referrerPolicy&&(i.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?i.credentials="include":e.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function o(e){if(e.ep)return;e.ep=!0;const i=r(e);fetch(e.href,i)}})();async function p(){const t=await fetch("/qac.json");if(!t.ok)throw new Error(`Failed to fetch /qac.json: ${t.status} ${t.statusText}`);const n=await t.json(),r=new Map;return n.forEach(o=>{const{form:e,location:i,root:s="",pattern:a=""}=o||{};if(typeof e!="string"||/disclaimer/i.test(e))return;const u={form:e,verseKey:i,root:s,pattern:a};r.has(e)||r.set(e,[]),r.get(e).push(u)}),r}function c(t){return(t||"").replace(/[\u064B-\u0652\u0670]/g,"")}function l(t){return(t||"").replace(/[إأآا]/g,"ا").replace(/ى/g,"ي").replace(/ؤ/g,"و").replace(/ئ/g,"ي").replace(/ة/g,"ه").replace(/ـ/g,"")}function g(t){const n=["وال","فال","بال","كال","لل","ال","و","ف","ب","ك","ل","س"],r=["ات","ان","ين","ون","ة","ه","ها","هم","نا","ي"],o=new Set([t]);return n.forEach(e=>{t.startsWith(e)&&o.add(t.slice(e.length))}),r.forEach(e=>{t.endsWith(e)&&o.add(t.slice(0,-e.length))}),n.forEach(e=>{if(t.startsWith(e)){const i=t.slice(e.length);r.forEach(s=>{i.endsWith(s)&&o.add(i.slice(0,-s.length))})}}),[...o].filter(e=>e)}function f(t){const n=[];for(const[r,o]of d)t(r)&&n.push(...o);return n}function h(t,n){if(!n)return t;const r=[];for(let o=0;o<n.length;o++)["f","3","l"].includes(n[o])&&r.push(o);return[...t].map((o,e)=>r.includes(e)?`<span class="root-letter">${o}</span>`:o).join("")}let d=new Map;async function m(){try{d=await p()}catch(t){console.error("خطأ في تحميل بيانات QAC:",t),document.getElementById("step-info").textContent="خطأ في التحميل.";return}document.getElementById("go").addEventListener("click",y)}function y(){const t=document.getElementById("lookup").value.trim();if(!t)return;document.getElementById("step-info").textContent="",document.getElementById("qac-panel").innerHTML="";let n=[],r="";if(n=d.get(t)||[],n.length&&(r="مطابقة دقيقة (مع تشكيل)"),!n.length){const o=c(t);n=f(e=>c(e)===o),n.length&&(r="مطابقة بدون تشكيل")}if(!n.length){const o=l(t);n=f(e=>l(e)===o),n.length&&(r="مطابقة بعد التطبيع (مع تشكيل)")}if(!n.length){const o=c(l(t));n=f(e=>c(l(e))===o),n.length&&(r="مطابقة بعد التطبيع وبدون تشكيل")}if(!n.length){const o=c(l(t)),e=g(o);for(const i of e)if(n=f(s=>c(l(s))===i),n.length){r="مطابقة بعد إزالة السوابق واللواحق";break}}E(n),document.getElementById("step-info").textContent=r||"لا نتائج."}function E(t){const n=document.getElementById("qac-panel");if(!t.length){n.textContent="لا توجد نتائج.";return}const r=document.createElement("ul");t.forEach(({form:o,pattern:e,root:i,verseKey:s})=>{const a=document.createElement("li"),u=e?h(o,e):o;a.innerHTML=[`الآية ${s}:`,`<strong>${u}</strong>`,`(الصيغة: ${o})`,i?`الجذر: ${i}`:"",e?`البنية: ${e}`:""].filter(Boolean).join(" "),r.appendChild(a)}),n.appendChild(r)}m().catch(t=>{console.error("خطأ في التهيئة:",t),document.getElementById("step-info").textContent=`خطأ: ${t.message}`});
